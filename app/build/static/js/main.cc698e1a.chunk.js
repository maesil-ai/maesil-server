(this.webpackJsonpmaesil=this.webpackJsonpmaesil||[]).push([[0],{140:function(e,t,n){e.exports=n(223)},145:function(e,t,n){},206:function(e,t){},207:function(e,t){},218:function(e,t){},221:function(e,t){},222:function(e,t){},223:function(e,t,n){"use strict";n.r(t);var a=n(14),i=n.n(a),o=n(110),r=n.n(o),s=(n(145),n(44)),c=n(15),l=n(2),u=n.n(l),d=n(10),h=n(3),v=n(9),f=n(12),m=n(13),p="https://13.209.193.142:8080",g=n(57),w=n.n(g),b=n(238),E=n(245),x=n(246),j=n(240),O=n(243),y=n(54),P=Object(b.a)((function(e){return Object(E.a)({root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1}})}));var C=function(){return P(),i.a.createElement(x.a,{position:"static"},i.a.createElement(j.a,null,i.a.createElement(y.b,{to:"/"},i.a.createElement(O.a,null))))};var k=function(){return i.a.createElement("footer",null,"\xa9 SW\ub9c8\uc5d0\uc2a4\ud2b8\ub85c 11\uae30 \ucf54\ub4dc\ube14\ub8e8\ud300")};var H=function(e){var t=e.title;return i.a.createElement("div",{id:"title"},t)},W=n(114),S=n.n(W);var I=function(){return i.a.createElement(S.a,{loading:!0,spinnerColor:"#9ee5f8",textColor:"#676767",logoSrc:"http://www.foodnmed.com/news/photo/201903/18296_3834_4319.jpg",text:"\ubd88\ub7ec\uc624\ub294 \uc911..."})},R=n(241),M=n(244),N=n(242),T=Object(b.a)((function(e){return Object(E.a)({root:{display:"flex",flexWrap:"nowrap",overflow:"auto",justifyContent:"flex-start",backgroundColor:e.palette.background.paper},gridList:{width:350,height:350,flexWrap:"nowrap",display:"inline-block",transform:"translateZ(0)"},title:{fontWeight:700},titleBar:{background:"rgba(100, 100, 100, 0.54)"}})}));var V=function(e){var t=e.exercises,n=T();return i.a.createElement(R.a,{className:n.root,cellHeight:300,cols:5.5},t.map((function(e){return i.a.createElement(M.a,{key:e.id,className:n.gridList},i.a.createElement(y.b,{to:"/exercise/"+e.id},i.a.createElement("img",{src:e.thumbUrl,alt:e.name,width:300})),i.a.createElement(N.a,{title:e.name,subtitle:e.playTime,classes:{root:n.titleBar,title:n.title}}))})))},D=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).loadExercises=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.get(p+"/exercises/");case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}}),e)}))),a.state={shelfDatas:[],loading:!0},a}return Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.loadExercises().then((function(t){var n,a=t.data.result,i=[],o=Object(c.a)(a);try{for(o.s();!(n=o.n()).done;){var r=n.value;i.push({id:r.exercise_id,name:r.title,thumbUrl:r.thumb_url?r.thumb_url:"http://www.foodnmed.com/news/photo/201903/18296_3834_4319.jpg",playTime:r.play_time})}}catch(l){o.e(l)}finally{o.f()}e.setState(Object(s.a)(Object(s.a)({},e.state),{},{shelfDatas:[{title:"\uadf8\ub0e5... \ubaa8\ub4e0 \uc6b4\ub3d9\ub4e4",exercises:i},{title:"\uccab\uae00\uc790 P\ub85c \uc2dc\uc791\ud558\ub294 \uc6b4\ub3d9\ub4e4!",exercises:i.filter((function(e){return"p"===e.name[0]||"P"===e.name[0]}))}],loading:!1}))}))}},{key:"render",value:function(){if(this.state.loading)return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null),i.a.createElement(I,null),i.a.createElement(k,null));var e=this.state.shelfDatas.map((function(e){return i.a.createElement(i.a.Fragment,{key:e.title},i.a.createElement(H,{title:e.title}),i.a.createElement(V,{exercises:e.exercises}))}));return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null),e,i.a.createElement(k,null))}}]),n}(i.a.Component),F=n(7),U=n(72),B={algorithm:"single-pose",model:{architecture:"MobileNetV1",multiplier:.75,outputStride:16,inputResolution:250,quantBytes:2},flipPoseHorizontal:!1,multiPose:{maxPoseDetections:5,minPartConfidence:.1,nmsRadius:30}},_=function e(t){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B;Object(h.a)(this,e),this.video=void 0,this.poseNet=void 0,this.config=void 0,this.readyToUse=void 0,this.modelInUse=void 0,this.resultPoses=void 0,this.record=void 0,this.load=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.c(n.config.model);case 2:t=e.sent,n.poseNet=t,n.modelInUse=!1,n.readyToUse=!0;case 6:case"end":return e.stop()}}),e)}))),this.getPoseResult=Object(d.a)(u.a.mark((function e(){var t,a,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.modelInUse){e.next=3;break}return n.record.length>0&&n.record.push(n.record[n.record.length-1]),e.abrupt("return",!1);case 3:n.modelInUse=!0,t=[],e.t0=n.config.algorithm,e.next="single-pose"===e.t0?8:"multi-pose"===e.t0?13:18;break;case 8:return e.next=10,n.poseNet.estimatePoses(n.video,{flipHorizontal:n.config.flipPoseHorizontal,decodingMethod:"single-person"});case 10:return a=e.sent,t=t.concat(a),e.abrupt("break",18);case 13:return e.next=15,n.poseNet.estimatePoses(n.video,{flipHorizontal:n.config.flipPoseHorizontal,decodingMethod:"multi-person",maxDetections:n.config.multiPose.maxPoseDetections,scoreThreshold:n.config.multiPose.minPartConfidence,nmsRadius:n.config.multiPose.nmsRadius});case 15:return i=e.sent,t=t.concat(i),e.abrupt("break",18);case 18:return t[0]&&n.record.push(t[0]),n.resultPoses=t,n.modelInUse=!1,e.abrupt("return",!0);case 22:case"end":return e.stop()}}),e)}))),this.video=t,this.config=a,this.modelInUse=!0,this.readyToUse=!1,this.resultPoses=[],this.record=[]};n(136);function z(e){return[e.y,e.x]}function L(e,t,n,a,i){e.beginPath(),e.arc(n,t,a,0,2*Math.PI),e.fillStyle=i,e.fill()}function q(e,t,n,a){var i=Object(F.a)(e,2),o=i[0],r=i[1],s=Object(F.a)(t,2),c=s[0],l=s[1],u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[0,0],h=Object(F.a)(d,2),v=h[0],f=h[1];a.beginPath(),a.moveTo(r*u+v,o*u+f),a.lineTo(l*u+v,c*u+f),a.lineWidth=1,a.strokeStyle=n,a.stroke()}function A(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],o=Object(F.a)(i,2),r=o[0],s=o[1],c=U.a(e,t);c.forEach((function(e){return q(z(e[0].position),z(e[1].position),"aqua",n,a,[r,s])}))}function G(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0,0],o=Object(F.a)(i,2),r=o[0],s=o[1],c=0;c<e.length;c++){var l=e[c];if(!(l.score<t)){var u=l.position,d=u.y,h=u.x;L(n,d*a+s,h*a+r,3,"aqua")}}}function X(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],i=Object(F.a)(a,2),o=i[0],r=i[1],s=U.b(e);t.rect(n*s.minX+o,n*s.minY+r,n*(s.maxX-s.minX),n*(s.maxY-s.minY)),t.strokeStyle="red",t.stroke()}var Y=n(135);function J(e,t){return Object(Y.poseSimilarity)(e,t,{strategy:"weightedDistance"})}function Z(e,t){for(var n=0,a=Array.from(Array(e.length),(function(){return new Array(t.length)})),i=0;i<e.length;i++)for(var o=0;o<t.length;o++)a[i][o]=J(e[i],t[o]);for(var r=e.length-1,s=0;s<t.length;r>0?r--:s++){var c=s,l=r,u=0,d=e.length-r;if(!(d/e.length<.7)){for(;l<e.length;l++,c++)u+=a[l][c];n<u/d&&(n=u/d)}}return n}var $=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;Object(h.a)(this,n),(a=t.call(this,e)).ctx=void 0,a.canvas=void 0,a.views=void 0,a.viewConfig=void 0,a.drawCanvas=function(){for(var e=a.ctx,t=0;t<a.views.length;t++)a.views[t].video.play();var n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[0,0],o=a.ctx;a.viewConfig.showVideo&&(o.save(),o.translate(a.viewConfig.flipPoseHorizontal?n*a.props.videoWidth:0,0),o.scale(a.viewConfig.flipPoseHorizontal?-1:1,1),o.drawImage(e,(a.viewConfig.flipPoseHorizontal?-1:1)*i[0],i[1],a.props.videoWidth*n,a.props.videoHeight*n),o.restore()),t&&t.forEach((function(e){var t=e.score,r=e.keypoints;t>=a.viewConfig.minPoseConfidence&&(a.viewConfig.showPoints&&G(r,a.viewConfig.minPartConfidence,o,n,i),a.viewConfig.showSkeleton&&A(r,a.viewConfig.minPartConfidence,o,n,i),a.viewConfig.showBoundingBox&&X(r,o,n,i))}))};!function e(t){t(),requestAnimationFrame((function(){e(t)}))}((function(){e.clearRect(0,0,a.props.videoWidth,a.props.videoHeight);for(var t=0;t<a.views.length;t++)a.views[t].calculator.getPoseResult(),n(a.views[t].video,a.views[t].calculator.resultPoses,a.views[t].scale,a.views[t].offset)}))},a.canvas=i.a.createRef(),a.viewConfig=a.props.viewConfig,a.views=a.props.views,a.state={finishCount:0};for(var o=0;o<a.views.length;o++)Object.assign(a.views[o],{calculator:new _(a.views[o].video)}),a.views[o].video.onended=function(){var e=a.state.finishCount+1;a.setState({finishCount:e}),1===e&&a.props.onExerciseFinish({score:Z(a.views[0].calculator.record,a.views[1].calculator.record),time:3780,calorie:1021})};return a}return Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.ctx=this.canvas.current.getContext("2d");for(var t=[],n=0;n<this.views.length;n++)t.push(this.views[n].calculator.load());Promise.all(t).then((function(){e.drawCanvas()}))}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("canvas",{ref:this.canvas,width:this.props.videoWidth,height:this.props.videoHeight},"\uc6b4\ub3d9 \uae30\ub2a5\uc774 \uc9c0\uc6d0\ub418\uc9c0 \uc54a\ub294 \ube0c\ub77c\uc6b0\uc800\uc785\ub2c8\ub2e4..\u3160\u3160"))}}]),n}(i.a.Component);$.defaultProps={videoWidth:800,videoHeight:600,views:[],onExerciseFinish:function(){},viewConfig:{flipPoseHorizontal:!1,showVideo:!0,showSkeleton:!0,showPoints:!0,showBoundingBox:!0,minPoseConfidence:.15,minPartConfidence:.1}};var K=$,Q=n(26),ee=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).guideVideo=i.a.createRef(),a.userVideo=i.a.createRef(),a.loadVideo=function(){var e=Object(d.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w.a.get(p+"/exercises/"+t);case 2:return n=e.sent,e.abrupt("return",n.data.result.video_url);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.loadStream=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"user",width:a.props.videoWidth,height:a.props.videoHeight}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),a.componentDidMount=function(){var e=a.loadVideo(a.state.id),t=a.loadStream();Promise.all([e,t]).then((function(e){var t=Object(F.a)(e,2),n=t[0],i=t[1],o=a.guideVideo.current,r=a.userVideo.current;o.src=n,r.srcObject=i,new Promise((function(e){var t=0,n=function(){(t+=1)>=2&&e()};o.onloadeddata=n,r.onloadeddata=n})).then((function(){return a.setState(Object(s.a)(Object(s.a)({},a.state),{},{isLoading:!1}))}))}))},a.handleExerciseFinish=function(e){console.log("HI!!!!"),w.a.post(p+"/exercises/"+a.state.id+"/history",{score:e.score,play_time:"00:01:03",cal:e.calorie}).then((function(t){console.log(t),200===t.data.code?a.setState(Object(s.a)(Object(s.a)({},a.state),{},{record:e,redirectToResult:!0})):console.log("\u314b\u314b..;;")})).catch((function(e){console.log("\u314b\u314b..\u3148\u3145!!\u314e\u314e..")}))},a.state={isLoading:!0,isFinished:!1,redirectToResult:!1,id:e.match.params.id,record:null},a}return Object(v.a)(n,[{key:"render",value:function(){if(this.state.redirectToResult)return i.a.createElement(Q.a,{push:!0,to:{pathname:"/result",state:{exerciseId:this.state.id,score:this.state.record.score,time:this.state.record.playTime,calorie:this.state.record.calorie}}});var e=i.a.createElement("div",null,i.a.createElement("video",{height:this.props.videoHeight,width:this.props.videoWidth,crossOrigin:"anonymous",style:{display:"none"},ref:this.guideVideo}),i.a.createElement("video",{height:this.props.videoHeight,width:this.props.videoWidth,crossOrigin:"anonymous",style:{display:"none"},ref:this.userVideo}));return this.state.isLoading?i.a.createElement("div",null,i.a.createElement(C,null),e,i.a.createElement(I,null),i.a.createElement(k,null)):i.a.createElement("div",null,i.a.createElement(C,null),e,i.a.createElement(K,{onExerciseFinish:this.handleExerciseFinish,videoWidth:this.props.videoWidth,videoHeight:this.props.videoHeight,views:[{video:this.guideVideo.current,scale:1,offset:[0,0]},{video:this.userVideo.current,scale:.3,offset:[540,400]}]}),i.a.createElement(k,null))}}]),n}(i.a.Component);ee.defaultProps={videoWidth:800,videoHeight:600};var te=ee;function ne(e){var t=e.time,n=e.calorie,a=e.score;return i.a.createElement("div",{className:"boxContainer"},i.a.createElement("div",{className:"box"}," ",(t-t%60)/60,"\ubd84 ",t%60,"\ucd08 "),i.a.createElement("div",{className:"box"}," ",Math.round(n),"\uce7c\ub85c\ub9ac \uc18c\ubaa8 "),i.a.createElement("div",{className:"box"}," ",Math.round(100*a),"\uc810 "))}ne.defaultProps={time:63,calorie:0,score:0};var ae=ne,ie=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(h.a)(this,n),(a=t.call(this,e)).componentDidMount=function(){w()({method:"GET",url:p+"/exercises/"+a.state.exerciseId}).then((function(e){var t=e.data.result.title;a.setState(Object(s.a)(Object(s.a)({},a.state),{},{loading:!1,exerciseName:t}))})).catch((function(e){console.log("\u314b\u314b")}))},a.state={loading:!0,exerciseId:a.props.location.state.exerciseId,stats:{time:a.props.location.state.time,calorie:a.props.location.state.calorie,score:a.props.location.state.score}},a}return Object(v.a)(n,[{key:"render",value:function(){if(this.state.loading)return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null),i.a.createElement(I,null),i.a.createElement(k,null));var e=this.state.stats;return i.a.createElement(i.a.Fragment,null,i.a.createElement(C,null),i.a.createElement(H,{title:this.state.exerciseName+" \uc644\ub8cc!"}),i.a.createElement(ae,{time:e.time,calorie:e.calorie,score:e.score}),"\ub2e4\uc74c \ucf54\uc2a4\ub3c4 \ucd94\ucc9c\ud574 \uc8fc\uc790~",i.a.createElement(k,null))}}]),n}(i.a.Component),oe=function(){return i.a.createElement(y.a,null,i.a.createElement(Q.d,null,i.a.createElement(Q.b,{exact:!0,path:"/",component:D}),i.a.createElement(Q.b,{path:"/exercise/:id",component:te}),i.a.createElement(Q.b,{path:"/result",component:ie}),i.a.createElement(Q.a,{path:"*",to:"/"})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(oe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[140,1,2]]]);
//# sourceMappingURL=main.cc698e1a.chunk.js.map